---
title: JDBC(작성중)
date: 2024-01-05 20:00:22 +09:00
categories:
  - 언어
  - Java
tags:
  - Java
  - JDBC
---

## 공부하게 된 배경
전부터 ORM에 대해서 공부하며 JDBC에 대해서 정확히 정리해야겠다고 생각했는데, HikariCP를 포스팅하면서 이참에 이어서 JDBC를 포스팅하는 것이 좋겠다고 생각해 포스팅하게 되었다.

> [HikariCP(Connection Pool) 포스팅 보러가기](https://byeongbumseo.github.io/posts/HikariCP/)

Spring Data JDBC, Spring Data JPA 등과 같은 기술이 등장하면서 JDBC API를 직접적으로 사용하는 일은 줄어들었지만, 이러한 기술들도 데이터베이스와 연동하기 위해서 내부적으로 JDBC를 이용하기 때문에 JDBC의 동작 흐름에 대해 알아둘 필요가 있다.


## 다루는 내용
이 글에서는 JDBC 를 설명하며 연관 지식으로
- DB Connection
- JDBC 드라이버
- JDK

에 대해서도 다룬다.  

## JDBC(Java DataBase Connectivity) 란?
---
Java에서 DB에 접속할 수 있도록 하는 Java API이다. JDBC는 데이터베이스에서 자료를 쿼리하거나 업데이트하는 방법을 제공한다.

사용하는 DBMS에 따라 어플리케이션에서 DB를 다루는 방식이 다르다면, 사용자가 알아야할 것이 늘어나고 개발하는 데에 많은 어려움이 있을 것이다. 그래서 JDBC를 통해 추상화된 인터페이스를 제공하고, 각 벤더사에서 각자의 DBMS에 따라 구현해놓은 드라이버를 설치하여 사용하는 방식으로 DB에 접근한다. 이를 통해 어떤 DB를 사용하든 개발자가 JDBC를 사용하는 방법은 변하지 않는다.

> **정리**  
> - JDBC는 DBMS에 종속되지 않는 관련 API를 제공한다. (서로 다른 DBMS일지라도 이를 통해 일관적인 방법으로 접근 가능)
> - JDBC API는 JDK[^1]에서 제공하며 JDBC 프로그래밍을 위해서는 JDBC 드라이버가 필요하다. JDBC 드라이버는 각 DBMS 회사에서 제공하는 라이브러리 압축파일(jar)을 말한다.
>   - Java API : 자바를 사용하여 쉽게 구현할 수 있도록 한 클래스 라이브러리의 집합. 즉, 복잡하지만 필요한 클래스들을 **미리 구현하여 사용자가 쉽게 구현하도록 하는 API**


[^1]: JDK는 개발자가 자바 기반 애플리케이션 개발을 위해 다운로드하는 소프트웨어 패키지다. 컴파일러와 클래스 라이브러리(Class Library)가 포함되어 있다.


### JDBC 드라이버
: 데이터베이스와의 통신을 담당하는 인터페이스


![JDBC 드라이버에 관한 설명](/assets/img/posts/2024-01-05-22-53-17.png)
> 출처 : https://devlog-wjdrbs96.tistory.com/139
- JDBC는 Java 애플리케이션 내에서 JDBC API를 사용하여 데이터베이스에 접근하는 단순한 구조이다. JDBC API를 사용하기 위해서는 JDBC 드라이버를 먼저 로딩한 후 데이터베이스와 연결하게 된다.
- 각각의 데이터베이스에 알맞은 JDBC 드라이버의 구현체를 이용해서 특정 벤더(Oracle, MSSQL, MySQL 등)의 데이터베이스에 접근할 수 있음

### 주요 클래스 및 인터페이스

![JDBC 표준 인터페이스](/assets/img/posts/2024-01-11-00-42-56.png)
- JDBC는 3가지 기능을 표준 인터페이스로 정의하여 제공한다.
  - java.sql.Connection - 연결
  - java.sql.Statement - SQL을 담은 내용
  - java.sql.ResultSet - SQL 요청 응답

- DriverManger : JDBC 드라이버 로드
- Connectoin : DB와 연결하기 위한 인터페이스
- Statement : SQl을 보내기 위한 통로. 인자가 없음.  
- PreparedStatement : Statement와 동일한데 차이점은 인자값으로 SQL을 받기 때문에 특정한 SQL에 대한 통로라고 생각하면 된다. 
- CallableStatement : PL/SQL을 호출할 때 사용
- ResultSet : SQL문의 결과를 저장하는 객체


### DB Connection
- DB를 사용하기 위해 DB와 애플리케이션 간 통신을 할 수 있는 수단
- DB Connection은 Database Driver와 Database 연결 정보를 담은 URL이 필요함
- Java의 DB Connection은 JDBC를 주로 이용하는데, URL 타입을 사용함

## JDBC의 동작 흐름
---
![JDBC 과정](/assets/img/posts/2024-01-05-22-33-11.png)


### java.sql Package
1. java.sql.Driver
  - DB와 연결하는 Driver class를 만들 때 반드시 implements 해야하는 Interface. 즉, JDBC 드라이버의 중심이 되는 Interface.
2. java.sql.Connection
  - 데이터베이스와 연결정보를 가지는 Interface.
  - DriverManager로부터 Connection 객체를 가져온다.
3. java.sql.Statement
  - SQL문을 DB에 전송하는 방법을 정의한 Interface. Connection을 통해 가져온다.
4. java.sql.ResultSet
  - SELECT 실행 결과를 조회할 수 있는 방법을 정의한 Interface.
5. java.sql.PreparedStatement
  - Statement의 하위 Interface. SQL문을 미리 컴파일하여 실행 속도를 높인다.
6. java.sql.CallableStatement
  - PreparedStatement의 하위 Interface. DBMS의 Stored procedure를 호출한다.


### JDBC 개발 단계
#### 1. JDBC Driver loading
- 드라이버 인터페이스를 구현한 클래스를 로딩한다. (Class.forName() 메서드를 통해 MySQL에서 제공하는 Driver클래스를 JVM Method Area에 로딩시킨다.)
- 각 벤더사마다 클래스 이름이 다르며 MySQL의 경우 "com.mysql.jdbc.Driver"다.
- JDBC Driver를 로딩하게 되면 DriverManager의 static 메서드를 사용할 수 있다.

```java
Class.forName("com.mysql.jdbc.Driver");
```

#### 2. Connection
- DriverManager의 getConnection 메서드를 이용하여 Connection 객체를 얻는다. 이 객체를 이용하여 Statement를 작성할 수 있다.(다음 3번에서 설명)
- Connection을 얻기 위해 필요한 URL 역시, 벤더사마다 다르다. MySQL의 경우 "jdbc:mysql://{IP}:{Port}/{사용할DB이름}"이다.
- MySQL에 접근 가능한 계정의 ID와 Password가 필요하다.
- 예시) IP : localhost, Port : default port(생략), 사용할DB이름 : testDB, (serverTimezone : 기준 시간대를 Query String 형식으로 설정가능)

```java
String url = "jdbc:mysql://localhost/testDB?serverTimezone=UTC";
String id = "testid";
String pw ="1234";
Connection conn = DriverManager.getConnection(url,id,pw);
```

#### 3. Statement / PreparedStatement
- 연결이 완료되면, Statement 나 PreparedStatement 객체를 이용하여 쿼리문을 전송해야한다.
- 위에서 얻은 Connection 객체의 createStatement(), prepareStatement() 메서드를 호출하여 각 객체를 얻을 수 있다.
- 쿼리를 수행할 때 동적으로 할당해야 하는 값이 있으면 PreparedStatement 객체를 사용하고, 동적으로 할당할 필요가 없으면 Statement 객체를 사용한다.

```java
//Statement 사용법. 위의 코드들과 이어짐.

Statement stmt = conn.createStatement(); //쿼리 수행을 위한 Statement 객체 생성
String sql = "SELECT name, owner, date_format(birth, '%Y년%m월%d일') date FROM pet"; //SQL 쿼리 작성 (세미콜론';' 제외)
ResultSet rs = stmt.executeQuery(sql); // 쿼리 수행. 조회된 레코드들은 ResultSet 객체에 추가.
```

```java
//PreparedStatement 사용법. 위의 코드들과 이어짐.
PreparedStatement pstmt = conn.prepareStatement("SELECT * from book where id=?"); //쿼리 수행을 위한 PreparedStatement 객체 생성
int id = 3;
pstmt.setInt(1, id); //id 값은 임의로 할당.
ResultSet rs = pstmt.executeQuery(); // 쿼리 수행. 조회된 레코드들은 ResultSet 객체에 추가.
```

- 만약 실행 결과를 확인하고 싶다면 아래와 같이 출력 가능하다.
```java
while(rs.next()){
// 레코드의 칼럼은 배열과 달리 0부터 시작하지 않고 1부터 시작.
// 데이터베이스에서 가져오는 데이터의 타입에 맞게 getString 또는 getInt 등을 호출한다.
  String name = rs.getString(1); // 또는 getString("name");
  String owner = rs.getString(2);
  String date = rs.getString(3);

  System.out.println(name + " " + owner + " " + date);
}
```
- INSERT나 UPDATE 문은 아래와 같이 작성 가능하다.
```java
String sql = "INSERT INTO pet VALUES (?,?,?,?,?,?)";
PreparedStatement pstmt = conn.prepareStatement(sql); //쿼리 수행을 위한 PreparedStatement 객체 생성

// 데이터 binding
pstmt.setString(1, name);
pstmt.setString(2, owner);
pstmt.setString(3, species);
pstmt.setString(4, gender);
pstmt.setString(5, birth);
pstmt.setString(6, death);

int count = pstmt.executeUpdate(); // 쿼리 수행.
```

#### 4. executeUpdate() / executeQuery()
- 작성한 쿼리들이 executeUpdate() 나 executeQuery() 메서드의 인자로 전달되어 실행된다.
- 쿼리의 결과가 있으면 executeQuery() 메서드를 호출하여 ResultSet 객체에 담고, 쿼리의 결과가 없으면 executeUpdate() 메서드를 호출하여 int형 변수에 결과값(영향을 미친 row의 개수)을 할당한다.

#### 5. ResultSet (SELECT의 경우)
- 쿼리문이 SELECT라면 ResultSet으로 받고, 그 이외에는 int 타입으로 받는다.
- ResultSet에는 SELECT 쿼리 결과의 레코드들이 담겨있다.

#### 6. close (ResultSet, Statement, Connection 순으로)

## JDBC를 사용하기 위한 환경 설정(조건)
---
1. DBMS 서버 설치
  - MySQL, Oracle, DB2 등
2. JDBC Driver 설치
  - 각 DBMS 페이지에서 제공하는 파일을 다운받기 (*.jar 파일)
3. JDBC API
  - JDK에 포함

## : Reference
[위키백과 - JDBC](https://ko.wikipedia.org/wiki/JDBC)  
