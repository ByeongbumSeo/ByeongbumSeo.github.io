---
title: HikariCP(ì‘ì„±ì¤‘)
date: 2023-12-07 22:00:22 +09:00
categories:
  - ì–¸ì–´
  - Java
tags:
  - Java
  - HikariCP
  - Database
  - Connection Pool
  - JDBC
---

## ê³µë¶€í•˜ê²Œëœ ë°°ê²½

ë‚˜ì™€ ê°™ì´ Java, íŠ¹íˆ Springbootë¥¼ ì´ìš©í•˜ì—¬ ê°œë°œí•˜ëŠ” ì‚¬ëŒë“¤ì—ê²Œ HikariCPëŠ” ë§¤ìš° ìµìˆ™í•˜ë‹¤.  
ë‚˜ëŠ” ê°œë°œì„ ì‹œì‘í•˜ë©´ì„œë¶€í„° ìì—°ìŠ¤ëŸ½ê²Œ HikariCPë¥¼ ì´ìš©í•˜ê³  ìˆì—ˆëŠ”ë°, ê·¸ë™ì•ˆ ì•„ë¬´ ìƒê°ì—†ì´ ì‚¬ìš©í•˜ë˜ ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì´ë²ˆ ê¸°íšŒì— ì •ë¦¬í•˜ë ¤ê³  í•œë‹¤.  

> Spring Boot 2.0 ë²„ì „ë¶€í„°ëŠ” Tomcat JDBC ëŒ€ì‹ ì— Hikarië¥¼ ì‚¬ìš©í•˜ë©° spring-boot-starter-data-jpa ì™€ spring-boot-starter-jdbcì— ì˜ì¡´ì„±ì´ í¬í•¨ë˜ì–´ ìˆë‹¤ê³  í•œë‹¤.

## ë‹¤ë£¨ëŠ” ë‚´ìš©
ì´ ê¸€ì—ì„œëŠ” HikariCP ë¥¼ ì„¤ëª…í•˜ë©° ì—°ê´€ ì§€ì‹ìœ¼ë¡œ
- DB Connection
- JDBC
- Connection Pool

ì— ëŒ€í•´ì„œë„ ë‹¤ë£¬ë‹¤.  

HikariCPë¥¼ ê³µë¶€í•˜ë©´ì„œ ìì—°ìŠ¤ëŸ½ê²Œ ìœ„ì™€ ê°™ì€ ë‚´ìš©ì„ ë‹¤ë£¨ê²Œ ë˜ì—ˆë‹¤.


## HikariCP(Hikari Connection Pool) ë€?

> Fast, simple, reliable. HikariCP is a "zero-overhead" production ready JDBC connection pool. At roughly 130Kb, the library is very light.

> ë¹ ë¥´ê³ , ê°„ë‹¨í•˜ê³  ë¯¿ì„ ìˆ˜ ìˆëŠ” HikariCPëŠ” "ì˜¤ë²„í—¤ë“œ ì œë¡œ"ì˜ í”„ë¡œë•ì…˜ ì§€ì› JDBC ì—°ê²° í’€ì…ë‹ˆë‹¤. ëŒ€ëµ 130KBì´ë©° ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ë§¤ìš° ê°€ë³ìŠµë‹ˆë‹¤.

ì¶œì²˜ : https://github.com/brettwooldridge/HikariCP#-hikaricpits-fasterhikari-hikal

- HikariCPëŠ” **ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°(Connection)ì„ ê´€ë¦¬í•´ ì£¼ëŠ” ë„êµ¬(ë¼ì´ë¸ŒëŸ¬ë¦¬)**ì´ë‹¤.
- HikariCPì—ì„œ ì»¤ë„¥ì…˜ í’€(Connection Pool)ì´ ì„¤ì •ëœ ì»¤ë„¥ì…˜ì˜ ì‚¬ì´ì¦ˆë§Œí¼ì˜ ì—°ê²°ì„ í—ˆìš©í•˜ë©° HTTP ìš”ì²­ì— ëŒ€í•´ ìˆœì°¨ì ìœ¼ë¡œ DB ì»¤ë„¥ì…˜ì„ ì²˜ë¦¬í•´ ì£¼ëŠ” ê¸°ëŠ¥ì„ ìˆ˜í–‰í•œë‹¤.
- SpringBootëŠ” ì»¤ë„¥ì…˜ í’€ ê´€ë¦¬ë¥¼ ìœ„í•´ HikariCPë¥¼ ì‚¬ìš©í•œë‹¤.Â 


## ë°ì´í„° ë² ì´ìŠ¤ ì»¤ë„¥ì…˜ í’€(DBCP : Database Connection Pool)

WAS(Web Application Server)ì™€ ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ì´ì˜ ì—°ê²°ì—ëŠ” ë§ì€ ë¹„ìš©ì´ ë“ ë‹¤. MySQL 8.0ì„ ê¸°ì¤€ìœ¼ë¡œ INSERT ë¬¸ì„ ìˆ˜í–‰í•  ë•Œ í•„ìš”í•œ ë¹„ìš©ì˜ ë¹„ìœ¨ì€ ë‹¤ìŒê³¼ ê°™ë‹¤. ê´„í˜¸ ì•ˆì˜ ìˆ«ìê°€ ë¹„ìœ¨ì„ ì˜ë¯¸í•œë‹¤.
Â 
1. Connecting (3)Â 
2. Sending query to server (2)
3. Parsing query (2)
4. Inserting row (1)
5. Inserting index(1)
6. Closing (1)
Â 
ì¦‰, ì„œë²„ê°€ DBì— ì—°ê²°í•˜ê¸° ìœ„í•œ Connecting ë¹„ìš©ì´ ê°€ì¥ í° ë¹„ìœ¨ì„ ì°¨ì§€í•œë‹¤. ì´ì²˜ëŸ¼ Connectionì„ ìƒì„±í•˜ëŠ” ì‘ì—…ì€ ë¹„ìš©ì´ ë§ì´ ë“œëŠ” ì‘ì—…ì´ë‹¤. ì´ë¥¼ ë³´ì™„í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì´ ë°”ë¡œÂ Connection Poolì´ë‹¤.


![ì»¤ë„¥ì…˜ í’€](/assets/img/posts/2023-12-11-23-40-04.png)
> ì¶œì²˜: https://www.ibm.com/developerworks/data/library/techarticle/dm-1105fivemethods/index.html 


ì»¤ë„¥ì…˜ í’€ì€ ë°ì´í„°ë² ì´ìŠ¤ì™€ ì—°ê²°ëœ ì»¤ë„¥ì…˜ì„ ë¯¸ë¦¬ ë§Œë“¤ì–´ ë†“ê³  ì´ë¥¼ poolë¡œ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ë‹¤. ì¦‰, í•„ìš”í•  ë•Œë§ˆë‹¤ ì»¤ë„¥ì…˜ í’€ì˜ ì»¤ë„¥ì…˜ì„ ì´ìš©í•˜ê³  ë°˜í™˜í•˜ëŠ” ê¸°ë²•ì´ë‹¤. ì´ì²˜ëŸ¼ ë¯¸ë¦¬ ë§Œë“¤ì–´ ë†“ì€ ì»¤ë„¥ì…˜ì„ ì´ìš©í•˜ë©´ Connectionì— í•„ìš”í•œ ë¹„ìš©ì„ ì¤„ì¼ ìˆ˜ ìˆë‹¤. ë”°ë¼ì„œ DBì— ë¹ ë¥´ê²Œ ì ‘ì†í•  ìˆ˜ ìˆë‹¤.
Â 
ë˜í•œ ì»¤ë„¥ì…˜ í’€ì„ ì‚¬ìš©í•˜ë©´ ì»¤ë„¥ì…˜ ìˆ˜ë¥¼ ì œí•œí•  ìˆ˜ ìˆì–´ì„œ ê³¼ë„í•œ ì ‘ì†ìœ¼ë¡œ ì¸í•œ ì„œë²„ ìì› ê³ ê°ˆì„ ë°©ì§€í•  ìˆ˜ ìˆìœ¼ë©° DB ì ‘ì† ëª¨ë“ˆì„ ê³µí†µí™”í•´ DB ì„œë²„ì˜ í™˜ê²½ì´ ë°”ë€” ê²½ìš° ìœ ì§€ë³´ìˆ˜ë¥¼ ì‰½ê²Œ í•  ìˆ˜ ìˆë‹¤.

### Connection Pool ë™ì‘ ê³¼ì •

![ì»¤ë„¥ì…˜í’€ ë™ì‘ê³¼ì •](/assets/img/posts/2023-12-11-23-50-20.png)
> Threadê°€ ì»¤ë„¥ì…˜ì„ ìš”ì²­í–ˆì„ ë•Œ ìœ íœ´ ì»¤ë„¥ì…˜ì´ ì¡´ì¬í•œë‹¤ë©´ í•´ë‹¹ ì»¤ë„¥ì…˜ì„ ë°˜í™˜í•´ì¤€ë‹¤.


![HandOffQueue](/assets/img/posts/2023-12-11-23-51-02.png)
> ë§Œì•½ ìœ íœ´ ì»¤ë„¥ì…˜ì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´, HandOffQueueë¥¼ Polling í•˜ë©´ì„œ ë‹¤ë¥¸ Threadê°€ ì»¤ë„¥ì…˜ì„ ë°˜ë‚©í•˜ê¸°ë¥¼ ê¸°ë‹¤ë¦°ë‹¤.  
> ë‹¤ë¥¸ Threadê°€ ì»¤ë„¥ì…˜ í’€ì— ì»¤ë„¥ì…˜ì„ ë°˜ë‚©í•˜ë©´ ì»¤ë„¥ì…˜ í’€ì€ HandOffQueueì— ë°˜ë‚©ëœ ì»¤ë„¥ì…˜ì„ ì‚½ì…í•˜ê³  HandOffQueueë¥¼ Polling í•˜ë˜ ThreadëŠ” ì»¤ë„¥ì…˜ì„ íšë“í•˜ê²Œ ëœë‹¤.



ë§Œì•½ ì»¤ë„¥ì…˜ í’€ì˜ í¬ê¸°ê°€ ë„ˆë¬´ ì‘ë‹¤ë©´, ì»¤ë„¥ì…˜ì„ íšë“í•˜ê¸° ìœ„í•´ ëŒ€ê¸°í•˜ê³  ìˆëŠ” Threadê°€ ë§ì•„ì§€ê²Œ ë  ê²ƒì´ë‹¤. ì´ëŸ¬í•œ ë¬¸ì œëŠ” ì»¤ë„¥ì…˜ í’€ì˜ í¬ê¸°ë¥¼ ëŠ˜ë ¤ì£¼ë©´ í•´ê²°í•  ìˆ˜ ìˆë‹¤. ê·¸ë ‡ë‹¤ë©´ ì»¤ë„¥ì…˜ í’€ì˜ í¬ê¸°ëŠ” ì–´ëŠ ì •ë„ì¸ ê²Œ ì¢‹ì„ê¹Œ?

## Connection Poolì˜ í¬ê¸°ì™€ ì„±ëŠ¥
ì»¤ë„¥ì…˜ í’€ì´ í¬ë©´ í´ìˆ˜ë¡ ì¢‹ì„ê¹Œ? ì–¸ëœ» ìƒê°í•´ë³´ë©´ ì»¤ë„¥ì…˜ì„ ë§ì´ ê°€ì§€ê³  ìˆì„ìˆ˜ë¡ ìœ ë¦¬í•  ê²ƒ ê°™ê¸´ í•˜ë‹¤.Â  
í•˜ì§€ë§Œ, Connectionì„ ì‚¬ìš©í•˜ëŠ” ì£¼ì²´ì¸ Threadì˜ ê°œìˆ˜ë³´ë‹¤ ì»¤ë„¥ì…˜ í’€ì˜ í¬ê¸°ê°€ í¬ë‹¤ë©´ ì‚¬ìš©ë˜ì§€ ì•Šê³  ë‚¨ëŠ” ì»¤ë„¥ì…˜ì´ ìƒê²¨ ë©”ëª¨ë¦¬ì˜ ë‚­ë¹„ê°€ ë°œìƒí•˜ê²Œ ëœë‹¤.
Â 
MySQLì˜ ê³µì‹ë ˆí¼ëŸ°ìŠ¤ì—ì„œëŠ” 600ì—¬ ëª…ì˜ ìœ ì €ë¥¼ ëŒ€ì‘í•˜ëŠ”ë° 15~20ê°œì˜ ì»¤ë„¥ì…˜ í’€ë§Œìœ¼ë¡œë„ ì¶©ë¶„í•˜ë‹¤ê³  ì–¸ê¸‰í•˜ê³  ìˆë‹¤. MySQLì€ ìµœëŒ€ ì—°ê²° ìˆ˜ë¥¼ ë¬´ì œí•œìœ¼ë¡œ ì„¤ì •í•œ ë’¤ ë¶€í•˜ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•˜ë©´ì„œ ìµœì í™”ëœ ê°’ì„ ì°¾ëŠ” ê²ƒì„ ì¶”ì²œí•œë‹¤.Â 
Â 
ìš°ì•„í•œ í˜•ì œë“¤ í…Œí¬ ë¸”ë¡œê·¸ì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì€ ê³µì‹ì„ ì¶”ì²œí•˜ê³  ìˆë‹¤.

![ì»¤ë„¥ì…˜ í’€ size ê³µì‹](/assets/img/posts/2023-12-12-23-46-30.png)
> ì¶œì²˜ : https://techblog .woowahan.com/2663/ 

- Tn = ì „ì²´ Threadì˜ ê°œìˆ˜
- Cm = í•˜ë‚˜ì˜ Taskì—ì„œ ë™ì‹œì— í•„ìš”í•œ Connection ìˆ˜

Â 
DBì™€ WASì˜ Context Switching ì—­ì‹œ í•œê³„ê°€ ìˆê¸° ë•Œë¬¸ì— Thread Poolì˜ í¬ê¸°ëŠ” Conncetion Poolì˜ í¬ê¸°ë¥¼ ê²°ì •í•˜ëŠ”ë° ë§¤ìš° ì¤‘ìš”í•˜ë‹¤.
Â 
ì»¤ë„¥ì…˜ í’€ì˜ í¬ê¸°ì™€ ì„±ëŠ¥ì— ëŒ€í•˜ì—¬ ì¢€ ë” ìì„¸íˆ ì•Œê³  ì‹¶ë‹¤ë©´ ë‹¤ìŒì„ ì°¸ê³ í•˜ì.
[https://wiki.postgresql.org/wiki/Number_Of_Database_Connections](https://wiki.postgresql.org/wiki/Number_Of_Database_Connections)

### JDBC(Java DataBase Connetion) ê³¼ì •
![JDBC ê³¼ì •](/assets/img/posts/2023-12-07-23-45-13.png)

JDBC ì—°ê²°ì€ ë“œë¼ì´ë²„ë¥¼ ë¡œë“œí•˜ê³  ì—°ê²°í•˜ì—¬ ê°ì²´ë¥¼ ë°›ì•„ì™€ì•¼ í•˜ëŠ” ê³¼ì •ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.  
ì´ ê³¼ì •ì€ ë§¤ë²ˆ ì‚¬ìš©ìê°€ ìš”ì²­í•  ë•Œë§ˆë‹¤ ë“œë¼ì´ë²„ë¥¼ ë¡œë“œí•˜ê³  ì»¤ë„¥ì…˜ ê°ì²´ë¥¼ ìƒì„±í•˜ì—¬ ì—°ê²°í•˜ê³  ì¢…ë£Œí•˜ëŠ” ê³¼ì •ì´ ë¶ˆí¸í•˜ê³  ì†ë„ì™€ ìì› ì†Œëª¨ì— ëŒ€í•œ ë‹¨ì ì´ ìˆì—ˆìŠµë‹ˆë‹¤.

- ê·¸ë˜ì„œ ì´ ë‹¨ì ì„ ë³´ì™„í•˜ê¸° ìœ„í•´ â€˜ë°ì´í„° ë² ì´ìŠ¤ ì»¤ë„¥ì…˜ í’€(DBCP)â€™ì„ ì‚¬ìš©í•©ë‹ˆë‹¤

### DBCP(Database Connection Pool) ì´í•´ ë° ê³¼ì •

#### ë°ì´í„°ë² ì´ìŠ¤ ì»¤ë„¥ì…˜ í’€ (DBCP: Database Connection Pool)

- ë°ì´í„°ë² ì´ìŠ¤ ì»¤ë„¥ì…˜ í’€ì€ ìµœì´ˆ Pool ë‚´ì—ì„œ ì—°ê²°(Connection)ë“¤ì„ í•˜ì—¬ HTTP ìš”ì²­ì— ë”°ë¼ ì‘ë‹µì„ ì œê³µí•˜ê³  ë°˜í™˜ë°›ì•„ì„œ ì´ë¥¼ **ì¬ì‚¬ìš©í•˜ëŠ” ê²ƒ**ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.
![DBCP ê³¼ì •](/assets/img/posts/2023-12-08-01-33-39.png)
> ì¶œì²˜: https://yjh5369.tistory.com/entry/HikariCP-%EC%86%8C%EA%B0%9C

#### ë°ì´í„°ë² ì´ìŠ¤ ì»¤ë„¥ì…˜ í’€ (DBCP: Database Connection Pool)ì˜ ê³¼ì •

1. WASê°€ ì‹¤í–‰ë˜ë©´ì„œ Pool ë‚´ì— Connectionë“¤ì„ ìƒì„±í•´ ë‘¡ë‹ˆë‹¤.
2. HTTPì˜ ìš”ì²­ì´ ì˜¬ë•Œ Pool ë‚´ì—ì„œ Connection ê°ì²´ë¥¼ ê°€ì ¸ë‹¤ê°€ ì‚¬ìš©í•©ë‹ˆë‹¤.
3. ì‚¬ìš©ì´ ì™„ë£Œëœ Connection ê°ì²´ëŠ” Pool ë‚´ì— ë°˜í™˜í•©ë‹ˆë‹¤.


#### DBCPì˜ ì¥ì 

1. WASì™€ ë°ì´í„° ë² ì´ìŠ¤ì™€ì˜ ì—°ê²°(Connection)ì„ ì¤„ì—¬ì„œ ë¹„ìš©ì„ ì¤„ì…ë‹ˆë‹¤.

2. 'Pool'ë‚´ì— ë¯¸ë¦¬ ì—°ê²°(Connection)ë˜ì–´ ìˆê¸°ì— ë§¤ë²ˆ ìƒì„±í•˜ëŠ” ë¹„ìš©ì„ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤

3. ì—°ê²°(Connection)ì— ëŒ€í•´ì„œ ì¡°ì •ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ë‹¨, ì¸í”„ë¼ì˜ DB Connection ìˆ˜ì™€ ë§ì¶”ì–´ì•¼ í•©ë‹ˆë‹¤.)

- Connection Poolì„ í¬ê²Œ ì„¤ì •í•˜ë©´ ë©”ëª¨ë¦¬ ì†Œëª¨ê°€ í° ëŒ€ì‹  ë§ì€ ì‚¬ëŒì˜ ëŒ€ê¸°ì‹œê°„ì´ ì¤„ì–´ë“­ë‹ˆë‹¤.
- Coonection Poolì„ ì ê²Œ ì„¤ì •í•˜ë©´ ì‚¬ìš©ìì˜ ëŒ€ê¸°ì‹œê°„ì´ ê¸¸ì–´ì§‘ë‹ˆë‹¤.

ì˜¤ë²„í—¤ë“œ

[^1] : HiKariCPëŠ” HiÂ·kaÂ·ri [hiÂ·kaÂ·'lÄ“] ( ì›ì‚°ì§€: ì¼ë³¸ì–´ ): ë¹›;ì´ë¼ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤. 
[^2] : ì˜¤ë²„í—¤ë“œ(overhead)ëŠ” ì–´ë–¤ ì²˜ë¦¬ë¥¼ í•˜ê¸° ìœ„í•´ ë“¤ì–´ê°€ëŠ” ê°„ì ‘ì ì¸ ì²˜ë¦¬ ì‹œê°„ Â· ë©”ëª¨ë¦¬ ë“±ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.


## HikariCP ì„¤ì¹˜

1. ë¹Œë“œ ê´€ë¦¬ ë„êµ¬ì— ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€

ê¸°ì¡´ ë¼ì´ë¸ŒëŸ¬ë¦¬ `spring-boot-data-jdbc` ë‚´ì— HikariCPê°€ í¬í•¨ì´ ë˜ì–´ ìˆë‹¤.

```gradle
dependencies {
	implementation 'org.springframework.boot:spring-boot-starter-data-jdbc'
}
```

2. application.properties íŒŒì¼ ìˆ˜ì •
ğŸ’¡ ê¸°ì¡´ì—ëŠ” â€˜datasourceâ€™ ë‚´ì— ë°”ë¡œ ì—°ê²°ì„ í•˜ì˜€ìœ¼ë‚˜ â€˜hikariâ€™ë¥¼ ì¤‘ê°„ì— ê±°ì³ì„œ í™˜ê²½ì„¤ì •ì„ í•˜ì˜€ìŠµë‹ˆë‹¤.

```properties
spring:
  datasource:
    hikari:
      driver-class-name: org.postgresql.Driver
      jdbc-url: jdbc:postgresql://localhost:8000/test_db
      username: test
      password: xxxxx
      pool-name: Hikari Connection Pool  # Pool Name Alias
      maximum-pool-size: 20
```





## : Reference
[ì½”ë“œ ì—°êµ¬ì†Œ:í‹°ìŠ¤í† ë¦¬-DB ì»¤ë„¥ì…˜ í’€(Connection pool)ì´ë€? HikariCPë€?](https://code-lab1.tistory.com/209)  
[https://dev.mysql.com/doc/refman/8.0/en/insert-optimization.html](https://dev.mysql.com/doc/refman/8.0/en/insert-optimization.html)  
[https://woowabros.github.io/experience/2020/02/06/hikaricp-avoid-dead-lock.html](https://woowabros.github.io/experience/2020/02/06/hikaricp-avoid-dead-lock.html)  
[https://hyuntaeknote.tistory.com/12](https://hyuntaeknote.tistory.com/12)  
[https://kafcamus.tistory.com/47](https://kafcamus.tistory.com/47)  
